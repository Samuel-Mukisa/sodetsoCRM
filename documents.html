<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fintech CRM - Document Management</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
     <div class="brand">
            <div class="badge-brand"> <img src="assets/images/sodetsologo.jpg" width="50" height="50"></div>
            <div>
                <div class="fw-bold company">SODETSO CRM</div>
                <small class="company">Management System</small>
            </div>
        </div>

    <nav class="nav-section">
      <a href="index.html" class="nav-link">
        <i class="fas fa-tachometer-alt"></i>
        Dashboard
      </a>
      <a href="leads.html" class="nav-link">
        <i class="fas fa-users"></i>
        Leads
      </a>
      <a href="interactions.html" class="nav-link">
        <i class="fas fa-comments"></i>
        Interactions
      </a>
      <a href="deals.html" class="nav-link">
        <i class="fas fa-handshake"></i>
        Deals
      </a>
      <a href="documents.html" class="nav-link active">
        <i class="fas fa-file-alt"></i>
        Documents
      </a>
      <a href="support.html" class="nav-link">
        <i class="fas fa-headset"></i>
        Support
      </a>
      <a href="users.html" class="nav-link">
        <i class="fas fa-user-cog"></i>
        Users
      </a>
    </nav>
  </div>

  <!-- Main Content -->
  <div class="main">
    <div class="topbar">
      <h1 class="page-title">Document Management</h1>
    </div>

    <div class="content-wrapper">
      <!-- Documents Section -->
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0"><i class="fas fa-file-alt text-primary me-2"></i>Documents</h5>
          <button class="btn btn-brand btn-sm" onclick="window.location.href='create-document.html'">
            <i class="fas fa-plus me-1"></i>
            Upload Document
          </button>
        </div>
        <div class="card-body">
          <!-- Filters -->
          <div class="row mb-3">
            <div class="col-md-3">
              <select class="form-select form-select-sm" id="typeFilter">
                <option value="">All Types</option>
                <option value="Financial Proposals">Financial Proposals</option>
                <option value="Contracts & Agreements">Contracts & Agreements</option>
                <option value="KYC Documents">KYC Documents</option>
                <option value="Identity Documents">Identity Documents</option>
                <option value="Proof of Address">Proof of Address</option>
                <option value="Bank Statements">Bank Statements</option>
                <option value="Tax Returns">Tax Returns</option>
                <option value="Financial Statements">Financial Statements</option>
                <option value="Licenses & Permits">Licenses & Permits</option>
                <option value="Correspondence">Correspondence</option>
                <option value="Presentations">Presentations</option>
                <option value="Reports">Reports</option>
                <option value="Other">Other</option>
              </select>
            </div>
            <div class="col-md-3">
              <select class="form-select form-select-sm" id="statusFilter">
                <option value="">All Status</option>
                <option value="Draft">Draft</option>
                <option value="Pending Review">Pending Review</option>
                <option value="Approved">Approved</option>
                <option value="Signed">Signed</option>
                <option value="Expired">Expired</option>
                <option value="Archived">Archived</option>
              </select>
            </div>
            <div class="col-md-3">
              <input type="text" class="form-control form-control-sm" id="searchFilter" placeholder="Search documents...">
            </div>
            <div class="col-md-3">
              <button class="btn btn-outline-secondary btn-sm" onclick="clearFilters()">
                <i class="fas fa-times me-1"></i>
                Clear Filters
              </button>
            </div>
          </div>

          <div class="table-responsive">
            <table class="table table-striped table-hover">
              <thead class="table-light">
                <tr>
                  <th><i class="fas fa-heading me-1"></i>Title</th>
                  <th><i class="fas fa-tag me-1"></i>Type</th>
                  <th><i class="fas fa-link me-1"></i>Related To</th>
                  <th><i class="fas fa-file me-1"></i>File</th>
                  <th><i class="fas fa-info-circle me-1"></i>Status</th>
                  <th><i class="fas fa-calendar me-1"></i>Upload Date</th>
                  <th><i class="fas fa-cogs me-1"></i>Actions</th>
                </tr>
              </thead>
              <tbody id="documentsTableBody">
                <!-- Documents will be populated by JavaScript -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <footer class="footer">
      <div>&copy; 2024 Fintech CRM. All rights reserved.</div>
    </footer>
  </div>

  <!-- Document Preview Modal -->
  <div class="modal fade" id="documentModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Document Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body" id="documentDetails">
          <!-- Document details will be populated here -->
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/main.js"></script>
  <script>
    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
      renderDocuments();

      // Add filter event listeners
      document.getElementById('typeFilter').addEventListener('change', filterDocuments);
      document.getElementById('statusFilter').addEventListener('change', filterDocuments);
      document.getElementById('searchFilter').addEventListener('input', filterDocuments);
    });

    function renderDocuments() {
      const documents = store.get('documents') || [];
      const tbody = document.getElementById('documentsTableBody');
      if (!tbody) return;

      tbody.innerHTML = documents.map(doc => `
        <tr>
          <td>
            <div class="fw-bold">${doc.title}</div>
            <small class="text-muted">${doc.description || ''}</small>
          </td>
          <td><span class="badge bg-${getDocumentTypeColor(doc.documentType)}">${doc.documentType}</span></td>
          <td>${doc.relatedTo || 'N/A'}</td>
          <td>
            <i class="fas ${getFileIcon(doc.fileType)} me-2"></i>
            ${doc.fileName || 'N/A'}
            <br><small class="text-muted">${formatFileSize(doc.fileSize)}</small>
          </td>
          <td><span class="badge bg-${getStatusColor(doc.status)}">${doc.status}</span></td>
          <td>${doc.uploadDate ? new Date(doc.uploadDate).toLocaleDateString() : 'N/A'}</td>
          <td>
            <div class="btn-group" role="group">
              <button class="btn btn-sm btn-outline-primary" onclick="viewDocument('${doc.id}')">
                <i class="fas fa-eye"></i>
              </button>
              <button class="btn btn-sm btn-outline-info" onclick="downloadDocument('${doc.id}')">
                <i class="fas fa-download"></i>
              </button>
              <button class="btn btn-sm btn-outline-secondary" onclick="editDocument('${doc.id}')">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-sm btn-outline-danger" onclick="deleteDocument('${doc.id}')">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </td>
        </tr>
      `).join('');
    }

    function getDocumentTypeColor(type) {
      const colors = {
        'Financial Proposals': 'primary',
        'Contracts & Agreements': 'success',
        'KYC Documents': 'warning',
        'Identity Documents': 'info',
        'Proof of Address': 'secondary',
        'Bank Statements': 'dark',
        'Tax Returns': 'danger',
        'Financial Statements': 'primary',
        'Licenses & Permits': 'success',
        'Correspondence': 'info',
        'Presentations': 'warning',
        'Reports': 'secondary',
        'Other': 'dark'
      };
      return colors[type] || 'secondary';
    }

    function getFileIcon(type) {
      const icons = {
        'pdf': 'fa-file-pdf text-danger',
        'doc': 'fa-file-word text-primary',
        'docx': 'fa-file-word text-primary',
        'xls': 'fa-file-excel text-success',
        'xlsx': 'fa-file-excel text-success',
        'ppt': 'fa-file-powerpoint text-warning',
        'pptx': 'fa-file-powerpoint text-warning',
        'txt': 'fa-file-text',
        'jpg': 'fa-file-image text-info',
        'jpeg': 'fa-file-image text-info',
        'png': 'fa-file-image text-info'
      };
      return icons[type?.toLowerCase()] || 'fa-file';
    }

    function getStatusColor(status) {
      const colors = {
        'Draft': 'secondary',
        'Pending Review': 'warning',
        'Approved': 'info',
        'Signed': 'success',
        'Expired': 'danger',
        'Archived': 'dark'
      };
      return colors[status] || 'secondary';
    }

    function formatFileSize(bytes) {
      if (!bytes) return 'N/A';
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      if (bytes === 0) return '0 Bytes';
      const i = parseInt(Math.floor(Math.log(bytes) / Math.log(1024)));
      return Math.round(bytes / Math.pow(1024, i) * 100) / 100 + ' ' + sizes[i];
    }

    function viewDocument(id) {
      const documents = store.get('documents') || [];
      const doc = documents.find(d => d.id === id);
      if (!doc) return;

      const details = document.getElementById('documentDetails');
      details.innerHTML = `
        <div class="row">
          <div class="col-md-8">
            <h6>Document Information</h6>
            <table class="table table-sm">
              <tr><td><strong>Title:</strong></td><td>${doc.title}</td></tr>
              <tr><td><strong>Type:</strong></td><td>${doc.documentType}</td></tr>
              <tr><td><strong>Related To:</strong></td><td>${doc.relatedTo || 'N/A'}</td></tr>
              <tr><td><strong>Status:</strong></td><td>${doc.status}</td></tr>
              <tr><td><strong>Uploaded By:</strong></td><td>${doc.uploadedBy}</td></tr>
              <tr><td><strong>Upload Date:</strong></td><td>${doc.uploadDate ? new Date(doc.uploadDate).toLocaleString() : 'N/A'}</td></tr>
              <tr><td><strong>Expiry Date:</strong></td><td>${doc.expiryDate ? new Date(doc.expiryDate).toLocaleString() : 'N/A'}</td></tr>
              <tr><td><strong>Access:</strong></td><td>${doc.accessPermissions}</td></tr>
              <tr><td><strong>Signature Status:</strong></td><td>${doc.signatureStatus}</td></tr>
            </table>
          </div>
          <div class="col-md-4">
            <h6>File Details</h6>
            <table class="table table-sm">
              <tr><td><strong>File Name:</strong></td><td>${doc.fileName}</td></tr>
              <tr><td><strong>File Type:</strong></td><td>${doc.fileType}</td></tr>
              <tr><td><strong>File Size:</strong></td><td>${formatFileSize(doc.fileSize)}</td></tr>
              <tr><td><strong>Version:</strong></td><td>${doc.versionNumber || '1.0'}</td></tr>
            </table>
          </div>
        </div>
        ${doc.description ? `<div class="mt-3"><strong>Description:</strong><br>${doc.description}</div>` : ''}
        ${doc.tags ? `<div class="mt-2"><strong>Tags:</strong> ${doc.tags}</div>` : ''}
      `;

      new bootstrap.Modal(document.getElementById('documentModal')).show();
    }

    function downloadDocument(id) {
      const documents = store.get('documents') || [];
      const doc = documents.find(d => d.id === id);
      if (doc && doc.fileStorageLocation) {
        window.open(doc.fileStorageLocation, '_blank');
      } else {
        showToast('File not available for download', 'warning');
      }
    }

    function editDocument(id) {
      window.location.href = `create-document.html?edit=${id}`;
    }

    function deleteDocument(id) {
      if (confirm('Are you sure you want to delete this document?')) {
        store.delete('documents', id);
        renderDocuments();
        showToast('Document deleted successfully');
      }
    }

    function filterDocuments() {
      const typeFilter = document.getElementById('typeFilter').value.toLowerCase();
      const statusFilter = document.getElementById('statusFilter').value.toLowerCase();
      const searchFilter = document.getElementById('searchFilter').value.toLowerCase();

      const documents = store.get('documents') || [];
      const filtered = documents.filter(doc => {
        const matchesType = !typeFilter || doc.documentType.toLowerCase().includes(typeFilter);
        const matchesStatus = !statusFilter || doc.status.toLowerCase().includes(statusFilter);
        const matchesSearch = !searchFilter ||
          doc.title.toLowerCase().includes(searchFilter) ||
          (doc.description && doc.description.toLowerCase().includes(searchFilter)) ||
          (doc.tags && doc.tags.toLowerCase().includes(searchFilter));

        return matchesType && matchesStatus && matchesSearch;
      });

      const tbody = document.getElementById('documentsTableBody');
      tbody.innerHTML = filtered.map(doc => `
        <tr>
          <td>
            <div class="fw-bold">${doc.title}</div>
            <small class="text-muted">${doc.description || ''}</small>
          </td>
          <td><span class="badge bg-${getDocumentTypeColor(doc.documentType)}">${doc.documentType}</span></td>
          <td>${doc.relatedTo || 'N/A'}</td>
          <td>
            <i class="fas ${getFileIcon(doc.fileType)} me-2"></i>
            ${doc.fileName || 'N/A'}
            <br><small class="text-muted">${formatFileSize(doc.fileSize)}</small>
          </td>
          <td><span class="badge bg-${getStatusColor(doc.status)}">${doc.status}</span></td>
          <td>${doc.uploadDate ? new Date(doc.uploadDate).toLocaleDateString() : 'N/A'}</td>
          <td>
            <div class="btn-group" role="group">
              <button class="btn btn-sm btn-outline-primary" onclick="viewDocument('${doc.id}')">
                <i class="fas fa-eye"></i>
              </button>
              <button class="btn btn-sm btn-outline-info" onclick="downloadDocument('${doc.id}')">
                <i class="fas fa-download"></i>
              </button>
              <button class="btn btn-sm btn-outline-secondary" onclick="editDocument('${doc.id}')">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-sm btn-outline-danger" onclick="deleteDocument('${doc.id}')">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </td>
        </tr>
      `).join('');
    }

    function clearFilters() {
      document.getElementById('typeFilter').value = '';
      document.getElementById('statusFilter').value = '';
      document.getElementById('searchFilter').value = '';
      renderDocuments();
    }
  </script>
</body>
</html>