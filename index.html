<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fintech CRM - Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="brand">
            <div class="badge-brand"> <img src="assets/images/sodetsologo.jpg" width="50" height="50"></div>
            <div>
                <div class="fw-bold company">SODETSO CRM</div>
                <small class="company">Management System</small>
            </div>
        </div>

        <nav class="nav-section">
            <a href="index.html" class="nav-link active">
                <i class="fas fa-tachometer-alt"></i>
                Dashboard
            </a>
            <a href="leads.html" class="nav-link">
                <i class="fas fa-users"></i>
                Leads
            </a>
            <a href="interactions.html" class="nav-link">
                <i class="fas fa-comments"></i>
                Interactions
            </a>
            <a href="deals.html" class="nav-link">
                <i class="fas fa-handshake"></i>
                Deals
            </a>
            <a href="documents.html" class="nav-link">
                <i class="fas fa-file-alt"></i>
                Documents
            </a>
            <a href="support.html" class="nav-link">
                <i class="fas fa-headset"></i>
                Support
            </a>
            <a href="users.html" class="nav-link">
                <i class="fas fa-user-cog"></i>
                Users
            </a>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main">
        <div class="topbar">
            <h1 class="page-title">Dashboard</h1>
            <button class="btn btn-brand btn-sm" onclick="store.initDemoData(); location.reload();">
                <i class="fas fa-database me-1"></i>
                Seed Demo Data
            </button>
        </div>

        <div class="content-wrapper">
            <!-- Stats Grid -->
            <div class="stat-grid">
                <div class="stat">
                    <h4>Total Institutions</h4>
                    <div class="value" id="totalInstitutions">0</div>
                </div>
                <div class="stat">
                    <h4>Total Contacts</h4>
                    <div class="value" id="totalContacts">0</div>
                </div>
                <div class="stat">
                    <h4>Active Deals</h4>
                    <div class="value" id="activeDeals">0</div>
                </div>
                <div class="stat">
                    <h4>Pipeline Value</h4>
                    <div class="value" id="pipelineValue">KES 0</div>
                </div>
                <div class="stat">
                    <h4>Open Tickets</h4>
                    <div class="value" id="openTickets">0</div>
                </div>
                <div class="stat">
                    <h4>Total Documents</h4>
                    <div class="value" id="totalDocuments">0</div>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="row">
                <div class="col-lg-8">
                    <div class="card">
                        <div class="card-header">Pipeline Revenue</div>
                        <div class="card-body">
                            <canvas id="pipelineChart" height="300"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="card">
                        <div class="card-header">Activities Distribution</div>
                        <div class="card-body">
                            <canvas id="activitiesChart" height="200"></canvas>
                        </div>
                    </div>
                    <div class="card mt-3">
                        <div class="card-header">Task Status</div>
                        <div class="card-body">
                            <canvas id="tasksChart" height="200"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="row mt-4">
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-header">Recent Activities</div>
                        <div class="card-body">
                            <div class="timeline" id="recentActivities">
                                <!-- Activities will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-header">Recent Tickets</div>
                        <div class="card-body">
                            <div class="timeline" id="recentTickets">
                                <!-- Tickets will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="footer">
            <div>&copy; 2025 SODETSO CRM. All rights reserved.</div>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="assets/js/main.js"></script>
    <script>
        // Update stats on dashboard load
        document.addEventListener('DOMContentLoaded', function () {
            const institutions = store.get('institutions');
            const contacts = store.get('contacts');
            const deals = store.get('deals');
            const tickets = store.get('tickets');
            const tasks = store.get('tasks');
            const documents = store.get('documents');

            document.getElementById('totalInstitutions').textContent = institutions.length;
            document.getElementById('totalContacts').textContent = contacts.length;
            document.getElementById('activeDeals').textContent = deals.filter(d => d.stage !== 'Closed Lost').length;
            document.getElementById('pipelineValue').textContent = formatCurrency(deals.reduce((sum, d) => sum + (d.expectedRevenue || 0), 0));
            document.getElementById('openTickets').textContent = tickets.filter(t => t.status === 'open').length;
            document.getElementById('pendingTasks').textContent = tasks.filter(t => t.status !== 'completed').length;
            document.getElementById('totalDocuments').textContent = documents.length;

            // Recent activities
            const recentActivities = store.get('activities').slice(-5).reverse();
            const activitiesContainer = document.getElementById('recentActivities');
            activitiesContainer.innerHTML = recentActivities.map(activity => `
        <div class="timeline-item">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <strong>${activity.type.charAt(0).toUpperCase() + activity.type.slice(1)}</strong>
              <span class="badge badge-brand ms-2">${activity.outcome}</span>
            </div>
            <small class="text-muted">${formatDate(activity.date)}</small>
          </div>
          <div class="mt-1">${activity.notes}</div>
          <div class="text-muted small">${activity.institutionName} - ${activity.contactName}</div>
        </div>
      `).join('');

            // Recent tickets
            const recentTickets = store.get('tickets').slice(-5).reverse();
            const ticketsContainer = document.getElementById('recentTickets');
            ticketsContainer.innerHTML = recentTickets.map(ticket => `
        <div class="timeline-item">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <strong>${ticket.subject}</strong>
              <span class="badge bg-${ticket.priority === 'high' ? 'danger' : ticket.priority === 'medium' ? 'warning' : 'secondary'} ms-2">${ticket.priority}</span>
            </div>
            <small class="text-muted">${ticket.status}</small>
          </div>
          <div class="mt-1">${ticket.description}</div>
          <div class="text-muted small">${ticket.requester}</div>
        </div>
      `).join('');
        });
    </script>
</body>

</html>